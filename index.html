<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fight Ball  Russia</title>
    
    <script>
        // ====================================================================
        // üö® –ù–ê–°–¢–†–û–ô–ö–ò: –ó–ê–ú–ï–ù–ò –≠–¢–ò –°–°–´–õ–ö–ò –ù–ê –°–í–û–ò!
        // ====================================================================
        
        // 1. –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–π Google Apps Script (—Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∏–∂–µ)
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzg7lN6WkEmWYWtwQeJESgsPiSZknDACdaLZo3PP2fp1Dl7naPltFxDdYIN_HozyBJNlA/exec"; 
        
        // 2. –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–≤–æ–π –∫–æ–Ω—Ç–∞–∫—Ç –∏–ª–∏ –±–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://t.me/my_support_bot)
        const SUPPORT_LINK = "https://t.me/fightBallHelp"; 
        
        // 3. –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏
        const POLICY_URL = "https://docs.google.com/document/d/19ZXBWJGYijUGIw7GwUUcuK4CkDfFuSqPxvbQEBJjqnQ/edit?usp=sharing";
        
        // 4. –°—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã Wildberries
        const WB_URL_SINGLE = "https://www.wildberries.ru/catalog/176733207/detail.aspx"; 
        const WB_URL_SET = "https://www.wildberries.ru/catalog/237586968/detail.aspx";      
        
        // –ö–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Ü–∏—Ñ—Ä—ã —à—Ç—Ä–∏—Ö–∫–æ–¥–∞)
        const VALID_CODES = ["6433", "0309", "5528"];
    </script>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #ff0055;
            --accent: #ffcc00;
            --bg-grad-start: #1a0b0b;
            --bg-grad-end: #000000;
            --text-color: white;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: radial-gradient(circle at center, var(--bg-grad-start) 0%, var(--bg-grad-end) 100%);
            color: var(--text-color); display: flex; flex-direction: column; align-items: center;
            height: 100vh; margin: 0; overflow: hidden; text-align: center;
            user-select: none; -webkit-tap-highlight-color: transparent;
            transition: background 0.5s;
        }

        .screen { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; position: absolute; top: 0; left: 0; padding: 20px; box-sizing: border-box; opacity: 0; transition: opacity 0.3s; }
        .active { display: flex; opacity: 1; }

        /* –ò–ì–†–û–í–û–ô –ö–†–£–ì */
        .score-circle {
            width: 210px; height: 210px; border-radius: 50%; border: 8px solid #333;
            display: flex; align-items: center; justify-content: center;
            font-size: 90px; font-weight: 900; margin: 10px 0;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0) 70%);
            transition: border-color 0.1s; position: relative; z-index: 2;
        }
        
        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä —ç–Ω–µ—Ä–≥–∏–∏ */
        .energy-bar-container {
            width: 200px; height: 4px; background: #333; border-radius: 2px; margin-top: 15px;
            position: relative; overflow: hidden; opacity: 0.7;
        }
        .energy-bar-fill {
            height: 100%; width: 0%; background: #00ff88; transition: width 0.05s linear;
        }
        
        @keyframes shake-anim {
            0% { transform: translate(1px, 1px); } 25% { transform: translate(-2px, -2px); }
            50% { transform: translate(2px, 0px); } 75% { transform: translate(-1px, 2px); } 100% { transform: translate(0, 0); }
        }
        .shake { animation: shake-anim 0.1s; }

        .hit { border-color: var(--primary); box-shadow: 0 0 50px var(--primary); color: var(--primary); }
        .hit-survival { border-color: var(--accent); box-shadow: 0 0 50px var(--accent); color: var(--accent); }

        button {
            padding: 16px 0; font-size: 17px; font-weight: 800; background: var(--primary); color: white; border: none; border-radius: 14px;
            width: 100%; max-width: 280px; margin-top: 10px; cursor: pointer; text-transform: uppercase; box-shadow: 0 4px 15px rgba(0,0,0,0.3); position: relative; z-index: 5;
            transition: background 0.3s;
        }
        button:active { transform: scale(0.96); }
        button:disabled { background: #444; color: #888; box-shadow: none; cursor: not-allowed; }
        button.secondary-btn { background: transparent; border: 1px solid #444; color: #aaa; box-shadow: none; font-size: 14px; margin-top: 15px; padding: 12px; }

        /* –í–´–ë–û–† –†–ï–ñ–ò–ú–ê */
        .mode-selector { display: flex; gap: 5px; margin-bottom: 10px; width: 95%; max-width: 340px; }
        .mode-btn { flex: 1; padding: 10px 5px; background: rgba(255,255,255,0.1); border: 1px solid #444; color: #aaa; border-radius: 12px; font-size: 11px; font-weight: bold; margin: 0; box-shadow: none; }
        .mode-btn.active-mode { background: var(--primary); color: white; border-color: var(--primary); }

        /* –ù–ê–°–¢–†–û–ô–ö–ò */
        .settings-panel { background: rgba(30,30,30,0.95); border: 1px solid #555; padding: 20px; border-radius: 15px; margin-bottom: 20px; width: 85%; max-width: 300px; display: none; z-index: 10; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        input[type=range] { width: 100%; margin: 15px 0; accent-color: var(--primary); cursor: pointer; }
        
        .debug-info { font-size: 10px; color: #444; font-family: monospace; margin-top: 5px; }

        /* –õ–ò–î–ï–†–ë–û–†–î */
        .leaderboard-box { background: rgba(0,0,0,0.3); width: 100%; max-height: 35vh; overflow-y: auto; border-radius: 16px; margin: 15px 0; }
        .leader-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .leader-name { font-size: 14px; font-weight: bold; display: block; color: #eee; text-align: left; }
        .leader-date { font-size: 10px; color: #888; display: block; margin-top: 3px; text-align: left; }
        .leader-score { font-size: 18px; font-weight: bold; color: #fff; }
        .leader-row:nth-child(1) .leader-name, .leader-row:nth-child(1) .leader-score { color: var(--accent); }

        /* –ú–ê–ì–ê–ó–ò–ù –°–ö–ò–ù–û–í */
        .skins-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-top: 10px; }
        .skin-card { background: rgba(255,255,255,0.05); border: 1px solid #444; border-radius: 10px; padding: 10px; cursor: pointer; position: relative; opacity: 0.5; }
        .skin-card.unlocked { opacity: 1; border-color: #666; }
        .skin-card.active-skin { border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }
        .skin-color { width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 5px; }
        .skin-name { font-size: 12px; font-weight: bold; }
        .lock-icon { font-size: 20px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; }

        /* –û–ö–ù–ê */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; justify-content: center; align-items: center; }
        .modal-content { background: #1a1a1a; padding: 25px; border-radius: 20px; border: 2px solid var(--primary); text-align: center; width: 85%; max-width: 320px; max-height: 80vh; overflow-y: auto; }

        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–ï (–¢–û–°–¢) */
        .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 10px 20px; border-radius: 20px; font-size: 12px; border: 1px solid #00ff88; z-index: 150; opacity: 0; transition: opacity 0.5s; pointer-events: none; }
        .toast.show { opacity: 1; }

        .career-box { margin-bottom: 20px; padding: 10px; border-top: 1px solid #333; border-bottom: 1px solid #333; width: 100%; }
        .career-text { font-size: 11px; color: #666; text-transform: uppercase; letter-spacing: 1px; }
        .career-num { font-size: 24px; color: #fff; font-weight: 900; }
        .rank-badge { font-size: 20px; font-weight: 800; color: var(--accent); margin-bottom: 5px; text-transform: uppercase; }
        
        .confetti { position: absolute; width: 10px; height: 10px; animation: fall linear forwards; z-index: 100; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        
        .leader-tabs { display: flex; width: 100%; margin-bottom: 10px; border-bottom: 1px solid #444; }
        .leader-tab { flex: 1; padding: 10px; font-size: 10px; font-weight: bold; color: #666; cursor: pointer; }
        .leader-tab.active-tab { color: #ff0055; border-bottom: 2px solid #ff0055; }
        
        .player-profile { width: 80%; text-align: left; margin-bottom: 15px; border: 1px solid #444; border-radius: 12px; padding: 12px; background: rgba(255,255,255,0.05); }
        .player-name-label { font-size: 10px; color: #888; }
        .player-name-val { font-size: 18px; font-weight: bold; color: #fff; margin-bottom: 5px; }
        .edit-link { font-size: 11px; color: var(--accent); text-decoration: underline; cursor: pointer; float: right; }
        
        .help-step { margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        .help-step:last-child { border-bottom: none; }
        .help-title { font-weight: bold; color: var(--accent); margin-bottom: 5px; display: block; }
    </style>
</head>
<body>

    <video id="wakeLockVideo" playsinline muted loop 
           style="position: fixed; top: 0; left: 0; width: 1px; height: 1px; opacity: 0.01; pointer-events: none; z-index: -1;">
        <source type="video/mp4" src="data:video/mp4;base64,AAAAHGZ0eXBNNBBisomqbW9vdgAAAGxtdmhkAAAAAAA0gAAAAAA0gAAAB3gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIGdHJhawAAAFx0a2hkAAAAAdSAAAAAAAAANIAAAAAAAAd4AAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAABAAAAAQAAAAAAAAAABmdtZGlhAAAAIG1kaGQAAAAANIAAAAAANIAAAAd4AAAAAAAABAAAAAAAQmhkbHIAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAABbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABVnN0YmwAAABzdHNkAAAAAAAAAAEAAABcbXA0dgAAAAAAAAABAAAAAQAAAAEASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAAAABRv//wAAABhzdHRzAAAAAAAAAAEAAAAHAAAABAAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAAHAAAAAQAAABRzdHN6AAAAAAAAAAAAAAAHAAAAHHN0Y28AAAAAAAAAAQAAAGwAAAAAAAAAAAAAAA1tZGF0AAAAAAAAAAAABwAAAA4AAAAUAAAAGgAAACAAAAAmAAAAKg==">
    </video>

    <div id="toast" class="toast">üì¢ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>

    <div id="helpModal" class="modal-overlay">
        <div class="modal-content" style="text-align: left; border-color: var(--accent); max-width: 360px;">
            <h2 style="text-align:center; margin-top:0; color:var(--accent); letter-spacing: 1px;">ü•ä –ì–ê–ô–î –ë–û–ô–¶–ê</h2>
            
            <div style="font-size:13px; line-height:1.5; color:#ddd; max-height:65vh; overflow-y:auto; padding-right:5px;">
                
                <div class="help-step">
                    <span class="help-title">1Ô∏è‚É£ –í–•–û–î –í –ò–ì–†–£</span>
                    –í–≤–µ–¥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ <b>4 —Ü–∏—Ñ—Ä—ã</b> –ø–æ–¥ —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–º –Ω–∞ —É–ø–∞–∫–æ–≤–∫–µ.<br>
                    üîë –ù–µ—Ç —É–ø–∞–∫–æ–≤–∫–∏? –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥: <b>6433</b>
                </div>

                <div class="help-step">
                    <span class="help-title">2Ô∏è‚É£ –ì–î–ï –¢–ï–õ–ï–§–û–ù? (–í–ê–ñ–ù–û)</span>
                    ‚úÖ <b>–†—è–¥–æ–º:</b> –ù–∞ —Å—Ç–æ–ª –∏–ª–∏ –ø–æ–ª –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π (1-2 –º–µ—Ç—Ä–∞).<br>
                    ‚ùå <b>–ù–µ –≤ –∫–∞—Ä–º–∞–Ω–µ:</b> –ú–∏–∫—Ä–æ—Ñ–æ–Ω —Ç–∞–º –Ω–µ —Å–ª—ã—à–∏—Ç.<br>
                    üì∫ <b>–≠–∫—Ä–∞–Ω:</b> –ù–µ –±–ª–æ–∫–∏—Ä—É–π —Ç–µ–ª–µ—Ñ–æ–Ω!
                </div>

                <div class="help-step">
                    <span class="help-title">3Ô∏è‚É£ –ù–ê–°–¢–†–û–ô–ö–ê –ß–£–í–°–¢–í–ò–¢–ï–õ–¨–ù–û–°–¢–ò ‚öôÔ∏è</span>
                    –≠—Ç–æ —Å–∞–º—ã–π –≥–ª–∞–≤–Ω—ã–π –ø–æ–ª–∑—É–Ω–æ–∫!<br>
                    üëâ <b>–ù–µ —Å—á–∏—Ç–∞–µ—Ç —É–¥–∞—Ä—ã?</b> –°–¥–≤–∏–Ω—å –í–õ–ï–í–û (–∫ —Ü–∏—Ñ—Ä–µ 1). –†–µ–∂–∏–º "–°—É–ø–µ—Ä-—Å–ª—É—Ö".<br>
                    üëâ <b>–°—á–∏—Ç–∞–µ—Ç –ª–∏—à–Ω–µ–µ?</b> –°–¥–≤–∏–Ω—å –í–ü–†–ê–í–û (–∫ —Ü–∏—Ñ—Ä–µ 10). –ó–∞—â–∏—Ç–∞ –æ—Ç —ç—Ö–∞ –∏ —à—É–º–∞.<br>
                    <i>–ò–¥–µ–∞–ª –æ–±—ã—á–Ω–æ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ (–Ω–∞ 5).</i>
                </div>
                
                <div class="help-step">
                    <span class="help-title">4Ô∏è‚É£ –†–ï–ñ–ò–ú–´</span>
                    ‚ö°Ô∏è <b>–°–ü–†–ò–ù–¢:</b> –ú–∞–∫—Å–∏–º—É–º —É–¥–∞—Ä–æ–≤ –∑–∞ 60 —Å–µ–∫.<br>
                    üíÄ <b>–í–´–ñ–ò–í–ê–ù–ò–ï:</b> –¢–∞–π–º–µ—Ä (10 —Å–µ–∫) –ø–∞–¥–∞–µ—Ç. –£–¥–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Ä–µ–º—è. –û—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è ‚Äî –ø—Ä–æ–∏–≥—Ä–∞–ª!<br>
                    üéµ <b>–†–ò–¢–ú:</b> –ü–æ–ø–∞–¥–∞–π –≤ —Ç–∞–∫—Ç –º–µ—Ç—Ä–æ–Ω–æ–º–∞.
                </div>

                <div class="help-step" style="background:rgba(255,0,0,0.1); padding:10px; border-radius:8px; border:1px solid #555;">
                    <span class="help-title" style="color:#ff4d4d;">üÜò –ß–¢–û –î–ï–õ–ê–¢–¨, –ï–°–õ–ò...</span>
                    ‚ùì <b>–ë—å—é, –∞ —Å—á–µ—Ç –Ω–µ –∏–¥–µ—Ç:</b><br>–ó–∞–π–¥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–æ—Å—Ç–∞–≤—å –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ <b>1 –∏–ª–∏ 2</b>.<br><br>
                    ‚ùì <b>–û—á–∫–∏ –∫—Ä—É—Ç—è—Ç—Å—è —Å–∞–º–∏:</b><br>–í –∫–æ–º–Ω–∞—Ç–µ —à—É–º–Ω–æ. –ü–æ—Å—Ç–∞–≤—å –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ <b>7 –∏–ª–∏ 8</b>.<br><br>
                    ‚ùì <b>–ì–∞—Å–Ω–µ—Ç —ç–∫—Ä–∞–Ω:</b><br>–ó–∞–π–¥–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚ûù –≠–∫—Ä–∞–Ω ‚ûù –ê–≤—Ç–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ‚ûù <b>–ù–∏–∫–æ–≥–¥–∞</b>.
                </div>
                
                <div class="help-step" style="border:none; text-align:center; margin-top:10px;">
                    üèÜ <b>–ü–û–ü–ê–î–ò –í –¢–û–ü!</b><br>
                    –ü–æ—Å–ª–µ –∏–≥—Ä—ã –Ω–∞–∂–º–∏ ¬´–°–û–•–†–ê–ù–ò–¢–¨¬ª, –∏ –º–∏—Ä —É–≤–∏–¥–∏—Ç —Ç–≤–æ–π —Ä–µ–∫–æ—Ä–¥!
                </div>
            </div>

            <button onclick="document.getElementById('helpModal').style.display='none'" style="margin-top:15px; background: #333;">–í–°–Å –ü–û–ù–Ø–¢–ù–û, –í –ë–û–ô! ü•ä</button>
        </div>
    </div>

    <div id="reviewModal" class="modal-overlay">
        <div class="modal-content">
            <div style="font-size: 24px; margin-bottom: 10px;">üéâ –ù–û–í–´–ô –†–ï–ö–û–†–î!</div>
            <div style="color: #ccc; font-size: 14px; margin-bottom: 20px;">
                –¢—ã –º–∞—à–∏–Ω–∞! ü§ñ<br>–û—Å—Ç–∞–≤—å –æ—Ç–∑—ã–≤, –µ—Å–ª–∏ –Ω—Ä–∞–≤–∏—Ç—Å—è –∏–≥—Ä–∞.
            </div>
            <button onclick="openReviewLink(WB_URL_SINGLE)" style="background: var(--accent); color: #000; margin-bottom: 10px;">‚≠êÔ∏è –ú–Ø–ß 60–≥—Ä</button>
            <button onclick="document.getElementById('reviewModal').style.display='none'" style="background: transparent; border: 1px solid #555;">–ü–û–ó–ñ–ï</button>
        </div>
    </div>

    <div id="skinsModal" class="modal-overlay">
        <div class="modal-content" style="border-color: #fff;">
            <h3>üé® –í–´–ë–ï–†–ò –°–¢–ò–õ–¨</h3>
            <p style="font-size:12px; color:#888;">–ù–∞–±–∏–≤–∞–π —É–¥–∞—Ä—ã, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–µ —Ü–≤–µ—Ç–∞!</p>
            <div class="skins-grid" id="skinsGrid"></div>
            <button onclick="document.getElementById('skinsModal').style.display='none'" style="margin-top:15px; background: #333;">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <div id="screen-login" class="screen active">
        <h1 style="letter-spacing: 2px; margin-bottom: 5px;">Fight Ball </h1>
        <p style="color:#666; font-size:12px; margin-bottom: 20px;">AUDIO ENGINE V4.1</p>
        
        <div class="career-box">
            <div class="career-text">–í—Å–µ–≥–æ —É–¥–∞—Ä–æ–≤</div>
            <div class="career-num" id="totalHitsLogin">0</div>
        </div>

        <input type="text" id="passInput" placeholder="4 –¶–ò–§–†–´ –ü–û–î –®–¢–†–ò–•–ö–û–î–û–ú" style="padding:15px; border-radius:12px; border:1px solid #444; background:#222; color:white; text-align:center; font-size:16px; margin-bottom:15px; width:80%;">
        <button onclick="checkCode()">–í–û–ô–¢–ò –í –ò–ì–†–£</button>
        
        <button onclick="document.getElementById('helpModal').style.display='flex'" class="secondary-btn" style="margin-top:10px; border-color:var(--accent); color:var(--accent); font-weight:bold;">üéì –ö–ê–ö –ò–ì–†–ê–¢–¨ (–ò–ù–°–¢–†–£–ö–¶–ò–Ø)</button>
        
        <p id="errorMsg" style="color:#ff4d4d; display:none; margin-top:10px; font-size:12px;">–ö–æ–¥ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç. –ü–æ–ø—Ä–æ–±—É–π 6433</p>
        
        <div style="margin-top: 20px; font-size: 11px; color: #666;">
            –í–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã? 
            <span onclick="openSupport()" style="color: #999; text-decoration: underline; cursor: pointer;">–ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É</span>
        </div>
        
        <div style="position: absolute; bottom: 10px; font-size: 9px; color: #444; width: 100%; text-align: center;">
            ¬© 2026 Fight Ball  RUSSIA. –í–°–ï –ü–†–ê–í–ê –ó–ê–©–ò–©–ï–ù–´.
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="mode-selector">
            <button class="mode-btn active-mode" id="btnSprint" onclick="setMode('sprint')">‚ö°Ô∏è –°–ü–†–ò–ù–¢</button>
            <button class="mode-btn" id="btnSurvival" onclick="setMode('survival')">üíÄ –í–´–ñ–ò–í–ê–ù–ò–ï</button>
            <button class="mode-btn" id="btnRhythm" onclick="setMode('rhythm')">üéµ –†–ò–¢–ú</button>
        </div>

        <div style="display:flex; justify-content:space-between; width:90%; align-items: center; margin-bottom: 5px;">
            <div style="background:rgba(255,255,255,0.1); padding:8px 25px; border-radius:20px; font-weight:bold; color:#fff; font-size: 42px; min-width: 110px;" id="timer">60</div>
            <div style="display:flex; flex-direction:column; align-items:flex-end;">
                <div style="font-size:12px; color:#aaa; cursor:pointer; border-bottom:1px dashed #555;" onclick="toggleSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            </div>
        </div>
        
        <div class="settings-panel" id="settingsPanel">
            <h3 style="margin-top:0; font-size:14px; margin-bottom:15px;">–ù–ê–°–¢–†–û–ô–ö–ò</h3>
            
            <label style="font-size:12px; color:#ccc;">–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <span id="sensVal">5</span></label>
            <input type="range" id="sensRange" min="1" max="10" value="5" oninput="updateSens(this.value)">
            <p style="font-size:10px; color:#666; margin-top:-10px;">1 - –®–µ–ø–æ—Ç, 10 - –ö—É–≤–∞–ª–¥–∞</p>
            
            <hr style="border:0; border-top:1px solid #444; margin: 15px 0;">
            
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <span style="font-size:14px; color:#ccc;">üîä –ó–≤—É–∫</span>
                <input type="checkbox" id="soundCheck" checked style="width:20px; height:20px;">
            </div>

            <button onclick="document.getElementById('helpModal').style.display='flex'" style="background: #444; border: 1px solid #666; margin-bottom: 5px;">‚ùì –ò–ù–°–¢–†–£–ö–¶–ò–Ø</button>
            <button onclick="openSkins()" style="background: linear-gradient(45deg, #FFD700, #DAA520); color: black; margin-bottom: 5px;">üé® –¢–ï–ú–´ / –°–ö–ò–ù–´</button>
            
            <button onclick="openSupport()" style="background: rgba(255,255,255,0.1); border: 1px solid #555; font-size: 12px; color: #ccc; margin-bottom: 5px;">
                üí¨ –ù–ê–ü–ò–°–ê–¢–¨ –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–£
            </button>
            
            <button onclick="logout()" style="background: #220000; border: 1px solid #ff4d4d; color: #ff4d4d; padding: 10px; font-size: 12px; margin-bottom: 5px;">üö™ –í—ã–π—Ç–∏</button>
            <button onclick="toggleSettings()" style="margin-top:5px; padding:10px; font-size:12px; background:#222; border:1px solid #444;">–ó–ê–ö–†–´–¢–¨</button>
        </div>
        
        <div class="score-circle" id="scoreDisplay">0</div>
        
        <div class="energy-bar-container">
            <div class="energy-bar-fill" id="energyBar"></div>
        </div>
        <div class="debug-info" id="debugStr">System Ready</div>
        
        <div style="color:#666; font-size:12px; margin-top:5px; margin-bottom:10px;" id="modeHint">–ù–ê–ë–ï–ô –ú–ê–ö–°–ò–ú–£–ú –ó–ê 60 –°–ï–ö</div>

        <button id="startBtn">–ù–ê–ß–ê–¢–¨ –†–ê–£–ù–î</button>
        <button onclick="showLeaderboard(true)" class="secondary-btn">üèÜ –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í</button>
    </div>

    <div id="screen-save" class="screen">
        <div style="font-size:14px; color:#aaa;">–í–ê–® –†–ï–ó–£–õ–¨–¢–ê–¢</div>
        <div class="rank-badge" id="rankDisplay">–ù–û–í–ò–ß–û–ö</div>
        <h1 style="font-size:80px; margin:0; color:var(--primary);" id="finalScore">0</h1>
        <div style="font-size:12px; color:var(--accent); font-weight:bold; margin-bottom:10px;" id="recordMsg"></div>

        <div style="display:flex; gap:15px; justify-content:center; margin-bottom:15px;">
            <div style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:5px;">üî• <span id="resCalories">0</span> –ö–ö–ê–õ</div>
            <div style="background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:5px;">üéÆ <span id="resMode">–°–ü–†–ò–ù–¢</span></div>
        </div>
        
        <div id="nameInputArea">
            <input type="text" id="nicknameInput" placeholder="–í–∞—à–µ –ò–º—è" maxlength="15" style="padding:14px; border-radius:12px; border:1px solid #444; background:#222; color:white; text-align:center; width:80%; margin-bottom: 10px;">
        </div>
        
        <div id="nameDisplayArea" style="display:none;" class="player-profile">
            <div class="player-name-label">–ò–≥—Ä–æ–∫: <span class="edit-link" onclick="editName()">(–∏–∑–º.)</span></div>
            <div class="player-name-val" id="displayName">–ê–Ω–æ–Ω–∏–º</div>
        </div>
        
        <div style="width: 100%; display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
            <button onclick="shareChallenge()" style="background: linear-gradient(90deg, #0088cc, #0099ff); border: none; box-shadow: 0 4px 15px rgba(0,136,204,0.4);">
                ‚öîÔ∏è –ë–†–û–°–ò–¢–¨ –í–´–ó–û–í
            </button>
            <button onclick="openProduct()" style="background: rgba(255,255,255,0.1); border: 1px solid #a100ff; color: #d699ff; font-size: 13px; padding: 12px; margin-top: 0;">
                üõç –ö–£–ü–ò–¢–¨ –¢–ê–ö–û–ô –ú–Ø–ß
            </button>
        </div>

        <p style="font-size:10px; color:#666; cursor:pointer; text-decoration:underline;" onclick="openPolicy()">–ü—Ä–∞–≤–∏–ª–∞ –∏ –ø–æ–ª–∏—Ç–∏–∫–∞</p>

        <button id="saveBtn" onclick="saveScore()">–°–û–•–†–ê–ù–ò–¢–¨ –í –¢–û–ü</button>
        <button onclick="location.reload()" class="secondary-btn">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
    </div>

    <div id="screen-leaders" class="screen">
        <h3>–¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í</h3>
        <div class="leader-tabs">
            <div class="leader-tab active-tab" id="tabSprint" onclick="switchLeaderTab('sprint')">‚ö°Ô∏è –°–ü–†–ò–ù–¢</div>
            <div class="leader-tab" id="tabSurvival" onclick="switchLeaderTab('survival')">üíÄ –í–´–ñ–ò–í–ê–ù–ò–ï</div>
        </div>
        <div class="leaderboard-box" id="leaderList"><div style="padding:20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
        <button id="leaderBackBtn" onclick="location.reload()" style="background: #333;">–ù–ê–ó–ê–î</button>
    </div>

    <script>
        // === –ù–ê–°–¢–†–û–ô–ö–ò –ê–£–î–ò–û (V4.1 FINAL) ===
        const FILTER_FREQ = 350; 
        const DEBOUNCE_TIME = 150; 
        const SELF_MUTE_TIME = 120; 
        const BUFFER_SIZE = 512; 

        let SENSITIVITY = 5; 
        let SLOPE_THRESHOLD = 0.03; 

        // === –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ===
        let score = 0, isRunning = false, timeLeft = 60;
        let currentMode = 'sprint';
        let audioCtx, analyser, microphone, scriptProcessor;
        let lastEnergy = 0, lastHitTime = 0;
        let isMutedByApp = false;
        let timerInterval, metronomeInterval;
        let totalHits = 0, personalBest = 0;
        let currentTheme = 'default';

        // –¢–ï–ú–´
        const THEMES = {
            'default': { name: '–ù–µ–æ–Ω (–°—Ç–∞–Ω–¥–∞—Ä—Ç)', color: '#ff0055', bg1: '#1a0b0b', bg2: '#000000', cost: 0 },
            'cyber': { name: '–ö–∏–±–µ—Ä (500 —É–¥.)', color: '#00ccff', bg1: '#0b1a1a', bg2: '#000000', cost: 500 },
            'toxic': { name: '–¢–æ–∫—Å–∏–∫ (1–∫ —É–¥.)', color: '#00ff88', bg1: '#0b1a0b', bg2: '#000000', cost: 1000 },
            'gold': { name: '–≠–õ–ò–¢–ê (5–∫ —É–¥.)', color: '#FFD700', bg1: '#1a1500', bg2: '#000000', cost: 5000 }
        };

        window.onload = function() {
            if (window.Telegram && window.Telegram.WebApp) { window.Telegram.WebApp.expand(); }
            
            const savedSens = localStorage.getItem('box_sens_v3');
            if(savedSens) { updateSens(savedSens); } else { updateSens(5); }

            totalHits = parseInt(localStorage.getItem('box_total_hits')) || 0;
            document.getElementById('totalHitsLogin').innerText = totalHits.toLocaleString();

            const savedTheme = localStorage.getItem('box_theme');
            if(savedTheme && THEMES[savedTheme]) applyTheme(savedTheme);

            if (localStorage.getItem('box_auth') === 'true') {
                showScreen('screen-game');
                showToast(); 
            }
        };

        function showToast() { document.getElementById('toast').classList.add('show'); setTimeout(() => document.getElementById('toast').classList.remove('show'), 3000); }
        function showScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        
        function checkCode() { 
            const val = document.getElementById('passInput').value.trim();
            if(VALID_CODES.includes(val)) { 
                localStorage.setItem('box_auth', 'true'); 
                showScreen('screen-game'); 
                showToast(); 
            } else { document.getElementById('errorMsg').style.display = 'block'; }
        }

        function updateSens(val) {
            SENSITIVITY = parseInt(val);
            document.getElementById('sensVal').innerText = SENSITIVITY;
            document.getElementById('sensRange').value = SENSITIVITY;
            SLOPE_THRESHOLD = 0.005 + ((SENSITIVITY - 1) * 0.01);
            localStorage.setItem('box_sens_v3', SENSITIVITY);
        }

        function toggleSettings() { const el = document.getElementById('settingsPanel'); el.style.display = (el.style.display==='block')?'none':'block'; }
        function logout() { localStorage.removeItem('box_auth'); location.reload(); }
        function openPolicy() { window.Telegram.WebApp.openLink(POLICY_URL); }

        // üî• NO SLEEP FUNCTON üî•
        async function activateNoSleep() {
            try {
                if ('wakeLock' in navigator) {
                    await navigator.wakeLock.request('screen');
                }
            } catch (err) { console.log("WakeLock failed: ", err); }
            const video = document.getElementById('wakeLockVideo');
            if (video) { video.play().catch(e => console.log("Video Hack failed: ", e)); }
        }

        // === –ê–£–î–ò–û –î–í–ò–ñ–û–ö ===
        document.getElementById('startBtn').addEventListener('click', async () => {
            if(isRunning) return;
            activateNoSleep();

            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                if (audioCtx.state === 'suspended') await audioCtx.resume();

                const stream = await navigator.mediaDevices.getUserMedia({
                    audio: { echoCancellation: false, noiseSuppression: false, autoGainControl: false, latency: 0 }
                });

                microphone = audioCtx.createMediaStreamSource(stream);
                analyser = audioCtx.createAnalyser();
                const filter = audioCtx.createBiquadFilter();
                const gainNode = audioCtx.createGain();

                filter.type = 'highpass';
                filter.frequency.value = FILTER_FREQ;
                gainNode.gain.value = 6.0;

                microphone.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(analyser);

                scriptProcessor = audioCtx.createScriptProcessor(BUFFER_SIZE, 1, 1);
                analyser.connect(scriptProcessor);
                scriptProcessor.connect(audioCtx.destination);

                scriptProcessor.onaudioprocess = processAudio;

                startRound();

            } catch (e) { alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É: " + e); }
        });

        function processAudio(e) {
            if(!isRunning || isMutedByApp) return;

            const buf = e.inputBuffer.getChannelData(0);
            let sum = 0;
            for(let i=0; i<buf.length; i++) sum += buf[i]*buf[i];
            const rms = Math.sqrt(sum / buf.length);

            const slope = rms - lastEnergy;
            const vis = Math.min(slope * 400, 100);
            document.getElementById('energyBar').style.width = Math.max(vis,0) + "%";
            document.getElementById('debugStr').innerText = `Slope: ${slope.toFixed(3)} / ${SLOPE_THRESHOLD.toFixed(3)}`;

            const now = Date.now();
            if (slope > SLOPE_THRESHOLD && (now - lastHitTime > DEBOUNCE_TIME)) {
                registerHit();
                lastHitTime = now;
            }
            lastEnergy = rms;
        }

        function registerHit() {
            score++;
            const el = document.getElementById('scoreDisplay');
            el.innerText = score;
            
            el.classList.add('shake');
            if(currentMode === 'survival') {
                el.classList.add('hit-survival');
                let bonus = 1.0; 
                if (score > 30) bonus = 0.5; 
                if (score > 60) bonus = 0.3;
                timeLeft += bonus;
                if(timeLeft > 10) timeLeft = 10;
                document.getElementById('timer').innerText = Math.floor(timeLeft);
            } else {
                el.classList.add('hit');
            }
            setTimeout(()=> { el.classList.remove('hit'); el.classList.remove('hit-survival'); el.classList.remove('shake'); }, 100);

            if(document.getElementById('soundCheck').checked) playBeep();
        }

        function playBeep() {
            isMutedByApp = true; 
            setTimeout(() => isMutedByApp = false, SELF_MUTE_TIME);

            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            
            o.frequency.setValueAtTime(1000, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.08);
            o.start(); o.stop(audioCtx.currentTime + 0.08);
        }

        function startRound() {
            score = 0; 
            document.getElementById('scoreDisplay').innerText = "0";
            isRunning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.querySelector('.mode-selector').style.opacity = '0.5';

            if(currentMode === 'survival') {
                timeLeft = 10;
                document.getElementById('timer').style.color = '#ffcc00';
            } else {
                timeLeft = 60;
                document.getElementById('timer').style.color = '#fff';
            }
            document.getElementById('timer').innerText = timeLeft;

            timerInterval = setInterval(() => {
                timeLeft -= 1;
                document.getElementById('timer').innerText = Math.floor(timeLeft);
                if(timeLeft <= 0) finishGame();
            }, 1000);
            
            if(currentMode === 'rhythm') {
                metronomeInterval = setInterval(() => { if(isRunning && document.getElementById('soundCheck').checked) playTick(); }, 600);
            }
        }
        
        function playTick() {
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            o.frequency.value = 800; o.type = 'square';
            g.gain.setValueAtTime(0.05, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
            o.start(); o.stop(audioCtx.currentTime + 0.05);
        }

        function finishGame() {
            isRunning = false; clearInterval(timerInterval);
            if(metronomeInterval) clearInterval(metronomeInterval);
            if(scriptProcessor) { scriptProcessor.disconnect(); microphone.disconnect(); }
            
            launchConfetti();
            document.querySelector('.mode-selector').style.opacity = '1';
            document.getElementById('startBtn').style.display = 'block';

            let rank = "–ù–û–í–ò–ß–û–ö";
            if(score > 30) rank = "–õ–Æ–ë–ò–¢–ï–õ–¨";
            if(score > 60) rank = "–ë–û–ï–¶";
            if(score > 100) rank = "–ú–ê–®–ò–ù–ê";
            
            totalHits += score;
            localStorage.setItem('box_total_hits', totalHits);
            
            document.getElementById('finalScore').innerText = score;
            document.getElementById('resCalories').innerText = Math.floor(score * 0.05);
            document.getElementById('resMode').innerText = currentMode.toUpperCase();
            document.getElementById('rankDisplay').innerText = rank;

            personalBest = parseInt(localStorage.getItem('box_pb_' + currentMode)) || 0;
            if (score > personalBest && score > 10) {
                localStorage.setItem('box_pb_' + currentMode, score);
                document.getElementById('recordMsg').innerText = "üèÜ –ù–û–í–´–ô –†–ï–ö–û–†–î!";
                document.getElementById('reviewModal').style.display = 'flex';
            } else {
                document.getElementById('recordMsg').innerText = "";
            }

            // –°–±—Ä–æ—Å –∫–Ω–æ–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            const btn = document.getElementById('saveBtn');
            btn.innerText = "–°–û–•–†–ê–ù–ò–¢–¨ –í –¢–û–ü";
            btn.disabled = false;

            checkSavedName();
            showScreen('screen-save');
        }

        function setMode(mode) {
            if(isRunning) return;
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(b => b.className = 'mode-btn');
            if(mode === 'sprint') {
                document.getElementById('btnSprint').className += ' active-mode';
                document.getElementById('modeHint').innerText = "–ù–ê–ë–ï–ô –ú–ê–ö–°–ò–ú–£–ú –ó–ê 60 –°–ï–ö";
                document.getElementById('timer').innerText = "60";
            } else if (mode === 'survival') {
                document.getElementById('btnSurvival').className += ' active-mode';
                document.getElementById('modeHint').innerText = "–ë–ï–ô, –ß–¢–û–ë–´ –ü–û–õ–£–ß–ò–¢–¨ –í–†–ï–ú–Ø";
                document.getElementById('timer').innerText = "10";
            } else {
                document.getElementById('btnRhythm').className += ' active-mode';
                document.getElementById('modeHint').innerText = "–ë–ï–ô –í –¢–ê–ö–¢";
            }
        }

        function openSkins() {
            const grid = document.getElementById('skinsGrid');
            grid.innerHTML = '';
            for (const [key, theme] of Object.entries(THEMES)) {
                const locked = totalHits < theme.cost;
                const active = currentTheme === key ? 'active-skin' : '';
                const lockIcon = locked ? '<div class="lock-icon">üîí</div>' : '';
                grid.innerHTML += `
                <div class="skin-card ${active}" style="opacity:${locked?0.5:1}" onclick="selectTheme('${key}', ${theme.cost})">
                    <div class="skin-color" style="background:${theme.color}"></div>
                    <div class="skin-name">${theme.name}</div>
                    ${lockIcon}
                </div>`;
            }
            document.getElementById('settingsPanel').style.display = 'none';
            document.getElementById('skinsModal').style.display = 'flex';
        }

        function selectTheme(key, cost) {
            if (totalHits < cost) { alert(`–ù—É–∂–Ω–æ ${cost} —É–¥–∞—Ä–æ–≤!`); return; }
            applyTheme(key);
            document.getElementById('skinsModal').style.display = 'none';
        }

        function applyTheme(key) {
            currentTheme = key;
            localStorage.setItem('box_theme', key);
            const t = THEMES[key];
            const root = document.documentElement;
            root.style.setProperty('--primary', t.color);
            root.style.setProperty('--bg-grad-start', t.bg1);
            root.style.setProperty('--bg-grad-end', t.bg2);
        }

        function saveScore() {
            let name = "";
            const savedName = localStorage.getItem('box_username');
            
            // –ü–û–õ–£–ß–ê–ï–ú TELEGRAM ID –î–õ–Ø –ü–û–õ–ò–¢–ò–ö–ò –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–ò
            const tgUser = window.Telegram.WebApp.initDataUnsafe?.user;
            const tgId = tgUser ? tgUser.id : "anon";

            if (savedName && document.getElementById('nameDisplayArea').style.display !== 'none') {
                name = savedName;
            } else {
                name = document.getElementById('nicknameInput').value.trim();
                if(name.length < 2) { alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!"); return; }
                localStorage.setItem('box_username', name); 
            }
            
            document.getElementById('saveBtn').innerText = "–û–¢–ü–†–ê–í–ö–ê..."; 
            document.getElementById('saveBtn').disabled = true;
            
            fetch(GOOGLE_SCRIPT_URL, { 
                method: "POST", 
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify({ 
                    name: name, 
                    score: score, 
                    mode: currentMode, 
                    date: new Date().toLocaleDateString(),
                    tgId: tgId 
                }) 
            })
            .then(r => r.text())
            .then(data => {
                console.log("Saved:", data);
                showLeaderboard(false, currentMode);
            })
            .catch(err => {
                alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.");
                document.getElementById('saveBtn').innerText = "–°–û–•–†–ê–ù–ò–¢–¨ –í –¢–û–ü";
                document.getElementById('saveBtn').disabled = false;
            });
        }

        function showLeaderboard(fromMenu = false, mode = 'sprint') {
            showScreen('screen-leaders');
            const backBtn = document.getElementById('leaderBackBtn');
            backBtn.innerText = fromMenu ? "–ù–ê–ó–ê–î –í –ú–ï–ù–Æ" : "–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê";
            backBtn.onclick = function() { fromMenu ? showScreen('screen-game') : location.reload(); };
            switchLeaderTab(mode);
        }

        function switchLeaderTab(mode) {
            document.querySelectorAll('.leader-tab').forEach(t => t.className = 'leader-tab');
            document.getElementById('tab' + mode.charAt(0).toUpperCase() + mode.slice(1)).classList.add('active-tab');
            
            const list = document.getElementById('leaderList'); 
            list.innerHTML = "<div style='padding:20px'>–ó–∞–≥—Ä—É–∑–∫–∞...</div>";
            
            fetch(GOOGLE_SCRIPT_URL + "?mode=" + mode)
            .then(r=>r.json())
            .then(data => {
                list.innerHTML = "";
                if(!data.length) list.innerHTML = "<div style='padding:20px'>–ü–æ–∫–∞ –ø—É—Å—Ç–æ</div>";
                data.forEach((row, i) => {
                    list.innerHTML += `
                    <div class="leader-row">
                        <div class="leader-left">
                            <span class="leader-name">#${i+1} ${row.name}</span>
                            <span class="leader-date">${row.date || ''}</span>
                        </div>
                        <span class="leader-score">${row.score}</span>
                    </div>`;
                });
            })
            .catch(e => { list.innerHTML = "<div style='padding:20px; color:#ff4d4d'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>"; });
        }

        function checkSavedName() {
            const savedName = localStorage.getItem('box_username');
            if(savedName) {
                document.getElementById('nameInputArea').style.display = 'none';
                document.getElementById('nameDisplayArea').style.display = 'block';
                document.getElementById('displayName').innerText = savedName;
            } else {
                document.getElementById('nameInputArea').style.display = 'block';
                document.getElementById('nameDisplayArea').style.display = 'none';
            }
        }
        function editName() {
            document.getElementById('nameInputArea').style.display = 'block';
            document.getElementById('nameDisplayArea').style.display = 'none';
        }
        function launchConfetti() {
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff', '#f0f'];
            for(let i=0; i<30; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random()*100 + 'vw';
                c.style.background = colors[Math.floor(Math.random()*colors.length)];
                c.style.animationDuration = (Math.random()*2+2) + 's';
                document.body.appendChild(c);
                setTimeout(()=>c.remove(), 4000);
            }
        }
        function openReviewLink(url) { window.Telegram.WebApp.openLink(url); document.getElementById('reviewModal').style.display = 'none'; }
        
        // –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò (–í–ò–†–ê–õ–¨–ù–û–°–¢–¨ –ò –ü–û–î–î–ï–†–ñ–ö–ê)
        function shareChallenge() {
            const productLink = WB_URL_SINGLE; 
            const message = `ü•ä –Ø –Ω–∞–±–∏–ª ${score} –æ—á–∫–æ–≤ –≤ Fight Ball !\n\n–°–ª–∞–±–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å? üòè\n\n–¢—Ä–µ–Ω–∞–∂–µ—Ä –±—Ä–∞–ª —Ç—É—Ç üëá`;
            const tgShareUrl = `https://t.me/share/url?url=${encodeURIComponent(productLink)}&text=${encodeURIComponent(message)}`;
            window.Telegram.WebApp.openTelegramLink(tgShareUrl);
        }

        function openProduct() {
            window.Telegram.WebApp.openLink(WB_URL_SINGLE);
        }
        
        function openSupport() {
            window.Telegram.WebApp.openTelegramLink(SUPPORT_LINK);
        }
    </script>
</body>
</html>
